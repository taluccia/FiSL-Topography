---
title: "DEMMosaicSKField"
author: "Anna Talucci"
date: '2022-07-15'
output: html_document
---



# clear environment
```{r}
rm(list=ls())
```


# Overview

Combine DEM tiles for SK field sites latitude and longitude range from FAB DEM from Compernicus (bare earth)

Lat long range for SK
Latitude (N)
[1] 53.1911
[1] 57.3646

Longitude (W)
[1] -111.3801
[1] -88.612

Softwood shield Shield
lat
 53.1911
 56.9364
lon
 -108.9862
 -88.612
 
Boreal Plain
lat
 53.7747
 57.3646
lon
 111.3801
 105.6072

# Packages 

```{r}
library(terra)
library(gdalUtilities)
library(sf)
library(tidyverse)
```


# Data

## Points
```{r}
pts = st_read("../data/FieldPoints/Field1983-2016/SKPoints1983-2016.shp", "SKPoints1983-2016") 
```
```{r}
head(pts)
```

```{r}
pt_shield = pts %>% filter(ecoregion =="Softwood Shield") 
pt_plains = pts %>% filter(ecoregion =="Boreal Plains") 
```

## rasters
```{r}
first<-rast("../data/DEMs/DEMFieldSK/N53W088_FABDEM_V1-0.tif")
last<-rast("../data/DEMs/DEMFieldSK/N57W112_FABDEM_V1-0.tif")
```

```{r}
first
```

```{r}
last
```

# Projections
```{r}
projection<-crs(last)
projection
```
# Masaic with Terra 

## Make list of rasters
```{r}
rlist <- list.files(path ="../data/DEMs/DEMFieldSK/",pattern = ".tif$",full.names = TRUE )
```
Softwood shield Shield
lat
 53.1911
 56.9364
lon
 -108.9862
 -88.612
c(1:22, 26:47, 51:72, 76:97)

Boreal Plain
lat
 53.7747
 57.3646
lon
 111.3801
 105.6072
 c(18:24,43:49, 68:74, 93:99, 116:122 )
```{r}
rlist
```

## Define as rasters
```{r}
r <- lapply(rlist, rast)
```

```{r}
r_shield = r[c(1:23, 26:48, 51:73, 76:98, 115:121)]
```
```{r}
r_plains = r[c(18:25,43:50, 68:75, 93:100, 116:123)]
```

## Make a spatial raster collection
```{r eval=FALSE, include=FALSE}
rsrc <- sprc(r)
```

```{r}
rsrc_shield <- sprc(r_shield)
```

```{r}
rsrc_plains <- sprc(r_plains)
```

##  Mosaic
```{r eval=FALSE, include=FALSE}
m <- mosaic(rsrc)
```

```{r}
m_shield <- mosaic(rsrc_shield)
```

```{r}
m_plains <- mosaic(rsrc_plains)
```
## Plot DEM

```{r eval=FALSE, include=FALSE}
plot(m)
```

```{r eval=FALSE, include=FALSE}
writeRaster(m, filename="../outputs/FieldDEM/DEMFieldSK.tif")
```

```{r eval=FALSE, include=FALSE}
writeRaster(m_shield, filename="../outputs/FieldDEM/DEMFieldSKshield.tif", overwrite=TRUE)
```

```{r eval=FALSE, include=FALSE}
writeRaster(m_plains, filename="../outputs/FieldDEM/DEMFieldSKplains.tif", overwrite=TRUE)
```

## Plot DEM

```{r}
plot(m_plains)
plot(st_geometry(pt_plains), add=TRUE)
```

```{r}
plot(m_shield)
plot(st_geometry(pt_shield), add=TRUE)
```