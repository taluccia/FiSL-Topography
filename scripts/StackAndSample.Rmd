---
title: "Stack and Sample"
author: "Anna Talucci"
date: "2023-03-03"
output: html_document
---

# Overview

Stack and sample geotiffs from RSAGA outputs

# Packages 

```{r}
library(terra)
library(gdalUtilities)
library(sf)
library(tidyverse)
```




# Data Points

```{r}
pts = st_read("../data/FieldPoints/Field1983-2016/AllPointsEA1983-2016.shp", "AllPointsEA1983-2016") 
```
```{r}
pts
```

## Filter for groups

```{r}
( yk = pts %>% filter(group1 =="YK") )
```

# Rasters

```{r}
rastlist <- list.files(path = "../data/SagaGeotiffs/yk", pattern='.tif$', all.files= T, full.names= T)
rastlist
```
```{r}
rast(rastlist[5])
```




```{r}
raststk <- terra::rast(rastlist[5:8])
```

```{r}
raststk
```

```{r}
extractPts = terra::extract(raststk,yk)
```

```{r}
(
df <- 
  yk %>%
  #--- define ID ---#
  mutate(ID := seq_len(nrow(.))) %>% 
  #--- merge by ID ---#
  left_join(., extractPts, by = "ID") %>%
  
  #--- drop geometry ---#
  st_set_geometry(NULL) %>%
  rename(aspect = aspect_EA_YK, cplan = cplan_EA_YK, cprof = cprof_EA_YK, slope = slope_EA_YK)
)
```

```{r}
write.csv(df, file = "../outputs/PointTerrain/extractTerrainSagaBasicYK.csv", row.names=FALSE)
```


